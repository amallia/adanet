

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>adanet &mdash; adanet [0.4.0] documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> adanet
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">adanet</a><ul>
<li><a class="reference internal" href="#estimators">Estimators</a><ul>
<li><a class="reference internal" href="#estimator"><span class="hidden-section">Estimator</span></a></li>
<li><a class="reference internal" href="#autoensembleestimator"><span class="hidden-section">AutoEnsembleEstimator</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">adanet</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>adanet</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/adanet.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-adanet">
<span id="adanet"></span><h1>adanet<a class="headerlink" href="#module-adanet" title="Permalink to this headline">¶</a></h1>
<p>An AdaNet algorithm implementation in Tensorflow using a single graph.</p>
<p>Copyright 2018 The AdaNet Authors. All Rights Reserved.</p>
<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<blockquote>
<div><a class="reference external" href="https://www.apache.org/licenses/LICENSE-2.0">https://www.apache.org/licenses/LICENSE-2.0</a></div></blockquote>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
<div class="section" id="estimators">
<h2>Estimators<a class="headerlink" href="#estimators" title="Permalink to this headline">¶</a></h2>
<div class="section" id="estimator">
<h3><span class="hidden-section">Estimator</span><a class="headerlink" href="#estimator" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="adanet.Estimator">
<em class="property">class </em><code class="descclassname">adanet.</code><code class="descname">Estimator</code><span class="sig-paren">(</span><em>head</em>, <em>subnetwork_generator</em>, <em>max_iteration_steps</em>, <em>mixture_weight_type='scalar'</em>, <em>mixture_weight_initializer=None</em>, <em>warm_start_mixture_weights=False</em>, <em>adanet_lambda=0.0</em>, <em>adanet_beta=0.0</em>, <em>evaluator=None</em>, <em>report_materializer=None</em>, <em>use_bias=False</em>, <em>metric_fn=None</em>, <em>force_grow=False</em>, <em>replicate_ensemble_in_training=False</em>, <em>adanet_loss_decay=0.9</em>, <em>worker_wait_timeout_secs=7200</em>, <em>model_dir=None</em>, <em>report_dir=None</em>, <em>config=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adanet/core/estimator.html#Estimator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#adanet.Estimator" title="Permalink to this definition">¶</a></dt>
<dd><p>The AdaNet algorithm implemented with the <cite>tf.estimator.Estimator</cite> API.</p>
<p>AdaNet is as defined in the paper: <a class="reference external" href="https://arxiv.org/abs/1607.01097">https://arxiv.org/abs/1607.01097</a>.</p>
<p>The AdaNet algorithm uses a weak learning algorithm to iteratively generate a
set of candidate subnetworks that attempt to minimize the loss function
defined in Equation (4) as part of an ensemble. At the end of each iteration,
the best candidate is chosen based on its ensemble’s complexity-regularized
train loss. New subnetworks are allowed to use any subnetwork weights within
the previous iteration’s ensemble in order to improve upon them. If the
complexity-regularized loss of the new ensemble, as defined in Equation (4),
is less than that of the previous iteration’s ensemble, the AdaNet algorithm
continues onto the next iteration.</p>
<p>AdaNet attempts to minimize the following loss function to learn the mixture
weights ‘w’ of each subnetwork ‘h’ in the ensemble with differentiable
convex non-increasing surrogate loss function Phi:</p>
<p>Equation (4):</p>
<blockquote>
<div><dl class="docutils">
<dt>F(w) = 1/m * sum_{i = 1 to m}(Phi(1 - y_i * sum_{j = 1 to N}(w_j * h_j)))</dt>
<dd><ul class="first last simple">
<li>sum_{j = 1 to N}(Gamma_j * <a href="#id9"><span class="problematic" id="id10">|w_j|</span></a>)</li>
</ul>
</dd>
</dl>
<p>where Gamma_j = lambda * r_j + beta, with lambda &gt;= 0 and beta &gt;= 0.</p>
</div></blockquote>
<p>This implementation uses an <cite>adanet.subnetwork.Generator</cite> as its weak learning
algorithm for generating candidate subnetworks. These are trained in parallel
using a single graph per iteration. At the end of each iteration, the
estimator saves the sub-graph of the best subnetwork ensemble and its weights
as a separate checkpoint. At the beginning of the next iteration, the
estimator imports the previous iteration’s frozen graph and adds ops for the
next candidates as part of a new graph and session. This allows the estimator
have the performance of Tensorflow’s static graph constraint (minus the
performance hit of reconstructing a graph between iterations), while having
the flexibility of having a dynamic graph.</p>
<p>NOTE: Subclassing <cite>tf.estimator.Estimator</cite> is only necessary to work with
<cite>tf.estimator.train_and_evaluate</cite> which asserts that the estimator argument is
a <cite>tf.estimator.Estimator</cite> subclass. However, all training is delegated to a
separate <cite>tf.estimator.Estimator</cite> instance. It is responsible for supporting
both local and distributed training. As such, the AdaNet <cite>Estimator</cite> is only
responsible for bookkeeping across iterations.</p>
<dl class="method">
<dt id="adanet.Estimator.evaluate">
<code class="descname">evaluate</code><span class="sig-paren">(</span><em>input_fn</em>, <em>steps=None</em>, <em>hooks=None</em>, <em>checkpoint_path=None</em>, <em>name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adanet/core/estimator.html#Estimator.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#adanet.Estimator.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>See <cite>tf.estimator.Estimator</cite> evaluate.</p>
</dd></dl>

<dl class="method">
<dt id="adanet.Estimator.train">
<code class="descname">train</code><span class="sig-paren">(</span><em>input_fn</em>, <em>hooks=None</em>, <em>steps=None</em>, <em>max_steps=None</em>, <em>saving_listeners=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adanet/core/estimator.html#Estimator.train"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#adanet.Estimator.train" title="Permalink to this definition">¶</a></dt>
<dd><p>See <cite>tf.estimator.Estimator</cite> train.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="autoensembleestimator">
<h3><span class="hidden-section">AutoEnsembleEstimator</span><a class="headerlink" href="#autoensembleestimator" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="adanet.AutoEnsembleEstimator">
<em class="property">class </em><code class="descclassname">adanet.</code><code class="descname">AutoEnsembleEstimator</code><span class="sig-paren">(</span><em>head</em>, <em>candidate_pool</em>, <em>max_iteration_steps</em>, <em>logits_fn=None</em>, <em>adanet_lambda=0.0</em>, <em>evaluator=None</em>, <em>metric_fn=None</em>, <em>force_grow=False</em>, <em>adanet_loss_decay=0.9</em>, <em>worker_wait_timeout_secs=7200</em>, <em>model_dir=None</em>, <em>config=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/adanet/autoensemble/estimator.html#AutoEnsembleEstimator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#adanet.AutoEnsembleEstimator" title="Permalink to this definition">¶</a></dt>
<dd><p>An Estimator that learns to ensemble models.</p>
<p>This <cite>Estimator</cite> learns to automatically ensemble models from a candidate
pool using the Adanet algorithm.</p>
<p>Example:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>python
numeric_feature = numeric_column(…)
categorical_column_a = categorical_column_with_hash_bucket(…)
categorical_column_b = categorical_column_with_hash_bucket(…)</p>
<p>categorical_feature_a_x_categorical_feature_b = crossed_column(…)
categorical_feature_a_emb = embedding_column(</p>
<blockquote>
<div>categorical_column=categorical_feature_a, …)</div></blockquote>
<dl class="docutils">
<dt>categorical_feature_b_emb = embedding_column(</dt>
<dd>categorical_column=categorical_feature_b, …)</dd>
</dl>
<p>head = tf.contrib.estimator.multi_class_head(n_classes=3)</p>
<p># Learn to ensemble linear and DNN models.
estimator = adanet.AutoEnsembleEstimator(</p>
<blockquote>
<div><p>head=head,
candidate_pool=[</p>
<blockquote>
<div><dl class="docutils">
<dt>tf.estimator.LinearEstimator(</dt>
<dd>head=head,
feature_columns=[categorical_feature_a_x_categorical_feature_b],
optimizer=tf.train.FtrlOptimizer(…)),</dd>
<dt>tf.estimator.DNNEstimator(</dt>
<dd><p class="first">head=head,
feature_columns=[</p>
<blockquote>
<div>categorical_feature_a_emb, categorical_feature_b_emb,
numeric_feature],</div></blockquote>
<p class="last">optimizer=tf.train.ProximalAdagradOptimizer(…),
hidden_units=[1000, 500, 100])],</p>
</dd>
</dl>
</div></blockquote>
<p>max_iteration_steps=50)</p>
</div></blockquote>
<p># Input builders
def input_fn_train:</p>
<blockquote>
<div># Returns tf.data.Dataset of (x, y) tuple where y represents label’s class
# index.
pass</div></blockquote>
<dl class="docutils">
<dt>def input_fn_eval:</dt>
<dd># Returns tf.data.Dataset of (x, y) tuple where y represents label’s class
# index.
pass</dd>
<dt>def input_fn_predict:</dt>
<dd># Returns tf.data.Dataset of (x, None) tuple.
pass</dd>
</dl>
<p>estimator.train(input_fn=input_fn_train, steps=100)
metrics = estimator.evaluate(input_fn=input_fn_eval, steps=10)
predictions = estimator.predict(input_fn=input_fn_predict)
<a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Charles Weill and Javier Gonzalvo

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>